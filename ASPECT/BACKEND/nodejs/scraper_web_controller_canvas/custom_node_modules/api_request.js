exports.apirequest=API_Query;
const { exec } = require("child_process");
function remove_linebreaks(  str ) { 
    return str.replace( /[\r\n]+/gm, "<br>" ); 
} 
function API_Query(req, res) {
    const myURL = new URL(req.url.toString(), 'http://localhost:8080/');
    console.log(myURL.searchParams.get('command'));
    var cmd=myURL.searchParams.get('command');
    if(cmd==="dir"){
        cmd="echo %cd%";
    }
    exec(cmd, (error, stdout, stderr) => {
        console.log(stdout);
		console.log("EXEC");
		if (error) {
			console.log('error: %s', error.message);        // A gerer comme pour les reponse correcte
			msg = error.message + "</br>";
        }
        else
        {
            if(stdout){
                console.log(stdout.length);
                var reponse=stdout;
                reponse=remove_linebreaks(reponse);
                res.writeHead(200, { 'Content-Type': 'text/html' });
                res.write(reponse);
                res.end();
            }
        }
	})
}